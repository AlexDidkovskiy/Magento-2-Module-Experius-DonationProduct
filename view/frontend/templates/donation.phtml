<?php /* @var $block Experius\DonationProduct\Block\Checkout\Donation\ListProduct */  ?>
<?php
$items = $block->getProductCollection();
$imageThumbnailId = 'category_page_grid';
$imageDetailId = 'category_page_grid';

if (count($items)) :
?>

<section class="exp-donation">
    <header>
        <h3>
            <?php echo __('Support a charity with your donation'); ?>
        </h3>
    </header>
    <p>
        <?php echo __('Support a charity with your donation'); ?>
    </p>
    <section class="exp-donation-product-list">
        <header><h4> <?php echo __('Charities that can use your support'); ?></h4></header>
        <?php $items = $block->getProductCollection(); ?>

        <?php  /* @var $item Magento\Catalog\Model\Product */ ?>
        <?php foreach ($items as $item) : ?>
            <article
                class="exp-donation-product"
                data-title="<?php echo $item->getName(); ?>"
                data-description="<?php echo $item->getShortDescription(); ?>"
                data-imageurl="<?php echo $block->getImage($item,$imageDetailId)->getImageUrl(); ?>"
                data-productid="<?php echo $item->getId(); ?>"
                data-addtocarturl="<?php echo $block->getAddToCartUrl($item); ?>">
                <a title="<?php echo $item->getName(); ?>" class="exp-donation-image-wrapper">
                    <img src="<?php echo $block->getImage($item,$imageThumbnailId)->getImageUrl(); ?>" alt="<?php echo $item->getName(); ?>" class="exp-donation-product-image" />
                </a>
                <a class="exp-donation-product-tocart">
                    <?php echo __('Donate'); ?>
                </a>
            </article>
        <?php endforeach; ?>
    </section>
</section>

<div class="donation-modal">
    <article>
        <img src="http://via.placeholder.com/200x200" alt="" class="charity-image" />
        <p class="charity-description"></p>
    </article>
    <form method="POST" class="charity-form" id="donation-product-addtocart-form">
        <?php echo $block->getBlockHtml('formkey'); ?>
        <div class="donation-amounts" data-role="">
            <?php foreach($block->getFixedAmounts() as $fixedAmount=>$viewFixedAmount): ?>
                <label class="donation-amount-btn" data-amount="<?php echo $fixedAmount; ?>">
                    <input type="radio" name="amount_fixed" value="<?php echo $fixedAmount; ?>">
                    <span><?php echo $viewFixedAmount; ?></span>
                </label>
            <?php endforeach; ?>
            <label for="donation-amount-custom"><?php echo $block->getCurrencySymbol(); ?></label>
            <input name="amount" id="amount" title="amount" class="input-text validate-number" type="text" data-validate="{required:true, 'validate-number': true}" aria-required="true" value="">
        </div>
        <button type="submit" class="button charity-button" id="submit"><?php echo __('Add donation to cart'); ?></button>
    </form>
</div>
<script>
    require([
        'jquery',
        'Magento_Ui/js/modal/modal'
    ], function ($, modal) {


        var options = {
            type: 'popup',
            responsive: true,
            innerScroll: true,
            title: 'test',
            buttons: []
        }

    var popupContainer = $('.donation-modal');
    var pImage = $('.charity-image', popupContainer);
    var pDescription = $('.charity-description', popupContainer);
    var pForm = $('.charity-form', popupContainer);
    var popup = modal(options, popupContainer);

    $('html').on('click', '.exp-donation-product', function(){
        var charity = jQuery(this);
        if(charity.data('productid') != ''){
            var title           = charity.data('title'),
                description     = charity.data('description'),
                imageurl        = charity.data('imageurl'),
                addtocarturl    = charity.data('addtocarturl');
                
                pImage.attr('src', imageurl).attr('alt', title);
                pDescription.html(description);
                pForm.attr('action', addtocarturl);
                pImage.attr('src', imageurl);

            options['title'] = 'asdfasdf';

            $('.donation-modal').modal(options).modal('openModal');
        }
    });

    <?php if($block->useAjaxAddToCart()): ?>
    $("#donation-product-addtocart-form").submit(function(e) {

        $.ajax({
            type: "POST",
            url: jQuery("#donation-product-addtocart-form").attr('action'),
            data: jQuery("#donation-product-addtocart-form").serialize(),
            showLoader: true
        });
        e.preventDefault();
    });
    <?php endif; ?>

});
</script>

<?php endif; ?>

<style>
    .exp-donation {
        background-color: rgba(28,100,138,0.05);
        box-sizing: border-box;
        margin-bottom: 24px;
        padding: 20px;
    }
    .exp-donation * {
        box-sizing: border-box;
    }
    .exp-donation-product-list {
        display: flex;
        flex-flow: row wrap;
        justify-content: space-between;
    }
    .exp-donation-product-list header {
        width: 100%;
    }
    .exp-donation-product {
        background-color: #FFFFFF;
        border-radius: 2px;
        box-shadow: 0 2px 4px 0 rgba(0,0,0,0.1);
        padding: 20px;
        flex: 0 0 23%;
    }
    .exp-donation-image-wrapper {
        display: block;
        height: 0;
        padding-bottom: 100%;
        position: relative;
        width: 100%;
    }
    .exp-donation-product-image {
        left: 50%;
        max-height: 100%;
        max-width: 100%;
        position: absolute;
        top: 50%;
        transform: translate(-50%,-50%);
        width: auto;
    }
    .exp-donation-product-tocart {
        background-color: #00457F;
        border-radius: 2px;
        border: none;
        color: white;
        display: block;
        height: 40px;
        line-height: 40px;
        padding: 0 5px;
        margin-top: 20px;
        text-align: center;
        width: 100%;
    }
    .exp-donation-product:hover .exp-donation-product-tocart {
        background-color: #ff8159;
    }
    
    /* Magento 1 inside column */
    .col-left .exp-donation {
        padding: 10px;
    }
    .col-left .exp-donation-product {
        flex: 0 0 100%;
    }
</style>
